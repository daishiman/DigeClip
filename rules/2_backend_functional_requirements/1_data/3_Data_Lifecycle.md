## データライフサイクル (保存期間・バックアップ)

### 1. データ保存期間

**概要:**
本システムでは、**お金をかけずに、経験の浅いエンジニアでも**運用しやすいよう、**保存期間を無期限**とします。
データが増えすぎた場合や運用上の問題が出てきた場合、将来的に手動/自動での削除やアーカイブ機能を追加検討します。

1. **ユーザー情報 (users テーブル)**
   - **保存期間:** **無期限**
   - **削除ポリシー:** 不要になったユーザー (退職/退会など) を手動で削除
   - **将来拡張:** GDPR等対応が必要な場合、自動削除ルールを検討

2. **取得したコンテンツ (contents テーブル)**
   - **保存期間:** **無期限**
   - **削除ポリシー:** 現時点では削除/アーカイブの運用を行わない
   - **将来拡張:** データ量が大きくなり過ぎた場合、古いデータを手動 or 自動で削除/アーカイブ

3. **要約結果 (summaries テーブル)**
   - **保存期間:** **無期限** (コンテンツと連動)
   - **段階的な要約** (概要/見出し/詳細など) もすべて保持
   - **将来拡張:** 量が増加し過ぎたら古い要約を手動/自動で整理

4. **通知履歴 (notifications テーブル)**
   - **保存期間:** **無期限**
   - **用途:** トラブル調査, 通知送信状況確認
   - **将来拡張:** 大量データによるパフォーマンス懸念が出た際に別テーブル or ログ管理システムへ移行

5. **ログ情報 (DB操作ログ / アクセスログ等)**
   - **保存場所:** Supabase のログ or 外部ロギングサービス
   - **保存期間:** デフォルト(無期限) / サービス仕様上の最大期間
   - **将来拡張:** 有料プランや外部ツールで期限設定を行う可能性

---

### 2. バックアップポリシー

1. **フルバックアップ**
   - **取得頻度:** 原則1日1回 (夜間) を理想とするが、無料枠制限に応じて調整
   - **保存先:** Supabase の自動バックアップ or 手動ダンプ
   - **保存期間:** Supabase で提供される範囲内

2. **増分バックアップ (将来検討)**
   - 初期は不要
   - 大規模化や可用性要件が上がった場合に導入を検討

3. **オフライン/外部へのエクスポート**
   - 重要データ(要約/AIモデル設定など)を手動でエクスポートし、ローカル or S3等に保管
   - 特に暗号化したAPIキー等は念のため別途バックアップ

---

### 3. リカバリ手順

1. **Supabaseコンソールでリストア**
   - バックアップ一覧から必要な日時を選択し、環境をリストア
   - 別インスタンスにリストアして検証後、本番に切り替えが理想

2. **手動ダンプファイルの適用** (大規模運用時)
   - `pg_dump` / `pg_restore` コマンドを使用
   - Dockerローカル or テスト環境でリストア→問題なければ本番に反映

3. **DR(ディザスタリカバリ)計画** (将来拡張)
   - 無料枠段階では基本的に考慮しない
   - 本格的な可用性要件が出てきた場合、有料プランや別リージョンレプリケーションを導入

---

### 4. データ削除・アーカイブ

1. **削除のタイミング**
   - 当面は**無期限**保存を基本方針
   - 手動で不要データを削除 or アーカイブする運用

2. **アーカイブ先**
   - Supabase の別テーブルに移行
   - ローカルCSV/Excel or S3 など外部ストレージへのエクスポート
   - 大量データの場合にのみ対応検討

3. **手動/自動の手順**
   - 初期リリースでは**手動運用**を前提とし、管理者がスクリプトやSupabaseコンソールで削除
   - 将来的に要望があれば**Vercel Cron** 等で自動化

---

**まとめ**
- **無期限保存**を基本とし、将来的に肥大化した場合に備えて**手動/自動アーカイブ**の仕組みを追加できる設計
- バックアップは**Supabaseの自動バックアップ**と**手動ダンプ**を組み合わせ、**簡易リカバリ**ができる体制
- 大規模/高可用性要件が出たら**有料プラン**や**別リージョンレプリケーション**を視野に入れる
- **初心者にも分かりやすい**運用フローで、段階的に拡張できる方針とする。