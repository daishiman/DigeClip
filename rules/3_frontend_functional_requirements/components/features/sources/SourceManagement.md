# ソース管理コンポーネント仕様

## 概要
ソース管理コンポーネントは、ソース一覧表示と新規追加・編集機能を統合した画面です。YouTubeチャンネル、RSSフィード、arXivなどの情報ソースを一元管理し、ユーザーがコンテンツ収集元を効率的に管理できるようにします。

## コンポーネント構造
```
SourceManagement
├── PageHeader
│   ├── Title
│   └── Description
├── SourceListContainer
│   └── SourceList
├── ModalContainer
│   ├── SourceFormModal (新規追加/編集)
│   └── DeleteConfirmModal (削除確認)
└── NotificationContainer
    └── Toast (操作結果通知)
```

## 状態管理
```typescript
// コンポーネント内部の状態
interface SourceManagementState {
  // ソースデータ
  sources: Source[];
  pagination: {
    page: number;
    pageSize: number;
    total: number;
  };

  // UI状態
  isLoading: boolean;
  searchQuery: string;
  sortColumn: string;
  sortDirection: 'asc' | 'desc';

  // モーダル状態
  isFormModalOpen: boolean;
  isDeleteModalOpen: boolean;
  currentSource: Source | null; // 編集/削除対象のソース

  // 操作状態
  isSubmitting: boolean;
  operationError: string | null;
  successMessage: string | null;
}
```

## 機能要件

### 1. ページ初期化
- ページロード時にソース一覧を取得
- デフォルトのソート順とページサイズを設定
- URLクエリパラメータからフィルタ条件を復元（オプション）

### 2. ソース一覧管理
- SourceListコンポーネントを使用してソース一覧を表示
- 検索、ソート、ページネーション機能の提供
- 各ソースの編集、削除、ステータス変更アクションのハンドリング

### 3. ソース追加/編集
- 「新規ソース追加」ボタンクリックで追加モーダル表示
- 行の編集ボタンクリックで編集モーダル表示
- SourceFormコンポーネントを使用してフォーム表示
- フォーム送信時のバリデーションと保存処理

### 4. ソース削除
- 削除ボタンクリックで確認モーダル表示
- 確認後にAPI呼び出しで削除実行
- 削除成功時にリストから該当ソースを削除

### 5. ステータス変更
- ステータストグル切り替えでAPI呼び出し
- 変更中の視覚的フィードバック
- 成功/失敗時の通知表示

### 6. エラーハンドリング
- API通信エラーの捕捉と表示
- フォームバリデーションエラーの表示
- ネットワークエラー時のリトライ機能

### 7. 通知管理
- 操作成功時のトースト通知
- エラー発生時のエラーメッセージ表示
- 通知の自動消去タイマー設定

## API連携

### 1. ソース一覧取得
- エンドポイント: `GET /api/admin/sources`
- パラメータ: `page`, `pageSize`, `search`, `sort`, `order`, `type`, `active`
- レスポンス処理: データ設定、ページネーション情報更新

### 2. ソース追加
- エンドポイント: `POST /api/admin/sources`
- リクエストボディ: フォーム入力データ
- 成功時: モーダルを閉じ、リストを更新、成功通知表示

### 3. ソース編集
- エンドポイント: `PUT /api/admin/sources/[id]`
- リクエストボディ: 更新フィールド
- 成功時: モーダルを閉じ、該当ソースを更新、成功通知表示

### 4. ソース削除
- エンドポイント: `DELETE /api/admin/sources/[id]`
- 成功時: リストから削除、成功通知表示

### 5. ステータス変更
- エンドポイント: `PATCH /api/admin/sources/[id]`
- リクエストボディ: `{ "active": boolean }`
- 成功時: 該当ソースのステータスを更新

## UI/UX考慮事項

### 1. レスポンシブデザイン
- モバイル: 縦スクロールレイアウト、カード表示
- タブレット/デスクトップ: テーブルレイアウト、横スクロール対応

### 2. ローディング状態
- 初期ロード時: スケルトンローダー表示
- 操作中: ボタンローディング状態、カーソル変更

### 3. エラー表示
- フォーム内エラー: フィールド下部に赤文字表示
- 操作エラー: トースト通知またはモーダル内メッセージ
- 致命的エラー: 画面上部にバナー表示

### 4. アニメーション
- モーダル開閉: フェードイン/アウト
- リスト更新: スムーズなトランジション
- ステータス変更: トグルアニメーション

### 5. 空状態
- データなし: 適切なメッセージと追加ボタン表示
- 検索結果なし: 検索条件リセットオプション提供

## アクセシビリティ

### 1. キーボード操作
- Tabキーでのフォーカス移動
- Enterキーでのボタン操作
- Escキーでのモーダル閉じる

### 2. スクリーンリーダー対応
- 適切なaria属性設定
- 動的コンテンツ変更時のアナウンス
- フォームラベルとコントロールの関連付け

### 3. フォーカス管理
- モーダル開閉時のフォーカストラップ
- 操作後の適切なフォーカス移動

## パフォーマンス最適化

### 1. データ取得
- ページネーションによるデータ分割取得
- キャッシュの活用（オプション）
- 必要最小限のデータ取得

### 2. レンダリング最適化
- メモ化によるコンポーネント再レンダリング防止
- 仮想化リストの検討（大量データ時）
- 状態更新の最適化

### 3. ネットワーク最適化
- デバウンス処理（検索入力時）
- 楽観的UI更新（ステータス変更時など）
- バッチ処理（複数選択削除時など）

## テスト要件

### 1. ユニットテスト
- 各機能の独立したテスト
- モック/スタブによるAPI分離
- エッジケースの検証

### 2. 統合テスト
- コンポーネント間の連携テスト
- 実際のAPIレスポンスを模したテスト

### 3. E2Eテスト
- 主要ユーザーフロー（追加、編集、削除）のテスト
- エラー状態のテスト