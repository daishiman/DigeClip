# ソース管理画面仕様書

## 画面概要
YouTubeチャンネルやブログRSS、arXivなどの監視対象ソースを管理する画面です。新規追加や既存ソースの編集・削除、有効/無効切り替えを行います。ユーザーはこの画面を通じて、DigeClipがどのコンテンツソースから情報を収集するかを制御できます。

## 画面レイアウト
```
+----------------------------------------------------------------------+
|  DigeClip > ソース管理                                  ユーザー名 ▼ |
+----------------------------------------------------------------------+
|                                                                      |
|  [+ 新規ソース追加]                検索: [                ]          |
|                                                                      |
|  +-------------------------------------------------------------------+
|  | ソース一覧                                                       |
|  +-------------------------------------------------------------------+
|  | 名前          | タイプ   | 詳細情報                | ステータス   |
|  +---------------+----------+------------------------+-------------+
|  | Tech Channel  | YouTube  | チャンネルID: UC12345  | 有効 ⚪      |
|  | AI Blog       | RSS      | aiblog.com/feed        | 有効 ⚪      |
|  | ML Papers     | arXiv    | カテゴリ: cs.AI        | 無効 ⚫      |
|  | Dev News      | RSS      | devnews.com/rss        | 有効 ⚪      |
|  | ...           | ...      | ...                    | ...         |
|  +-------------------------------------------------------------------+
|                                                                      |
|  ページ: < 1 2 3 ... 10 >                                           |
|                                                                      |
+----------------------------------------------------------------------+

// モーダル: 新規ソース追加/編集 (YouTube)
+--------------------------------------+
|  ソース追加/編集 - YouTube        ✕ |
+--------------------------------------+
|                                      |
|  ソース名*:                          |
|  [                             ]     |
|                                      |
|  ソースタイプ*:                      |
|  [YouTube ▼]                         |
|                                      |
|  チャンネルID*:                      |
|  [                             ]     |
|                                      |
|  チャンネルURL*:                     |
|  [                             ]     |
|                                      |
|  フィードURL:                        |
|  [                             ]     |
|                                      |
|  登録者数:                           |
|  [                             ]     |
|                                      |
|  サムネイルURL:                      |
|  [                             ]     |
|                                      |
|  ステータス:                         |
|  (⚪) 有効  (⚫) 無効                 |
|                                      |
|  [キャンセル]        [保存]          |
|                                      |
+--------------------------------------+

// モーダル: 新規ソース追加/編集 (RSS)
+--------------------------------------+
|  ソース追加/編集 - RSS            ✕ |
+--------------------------------------+
|                                      |
|  ソース名*:                          |
|  [                             ]     |
|                                      |
|  ソースタイプ*:                      |
|  [RSS ▼]                             |
|                                      |
|  サイトURL*:                         |
|  [                             ]     |
|                                      |
|  フィードURL*:                       |
|  [                             ]     |
|                                      |
|  言語:                               |
|  [日本語 ▼]                          |
|                                      |
|  ファビコンURL:                      |
|  [                             ]     |
|                                      |
|  ステータス:                         |
|  (⚪) 有効  (⚫) 無効                 |
|                                      |
|  [キャンセル]        [保存]          |
|                                      |
+--------------------------------------+

// モーダル: 新規ソース追加/編集 (arXiv)
+--------------------------------------+
|  ソース追加/編集 - arXiv          ✕ |
+--------------------------------------+
|                                      |
|  ソース名*:                          |
|  [                             ]     |
|                                      |
|  ソースタイプ*:                      |
|  [arXiv ▼]                           |
|                                      |
|  カテゴリ*:                          |
|  [cs.AI ▼]                           |
|                                      |
|  検索クエリ*:                        |
|  [                             ]     |
|                                      |
|  ステータス:                         |
|  (⚪) 有効  (⚫) 無効                 |
|                                      |
|  [キャンセル]        [保存]          |
|                                      |
+--------------------------------------+
```

## 機能要件
1. **ソース一覧表示**
   - テーブル形式で表示
   - カラム: ソース名、タイプ、詳細情報（タイプに応じた主要情報）、ステータス（有効/無効）
   - 各行にアクション: 編集、削除
   - ページネーション機能

2. **新規ソース追加**
   - 「新規ソース追加」ボタンでモーダル表示
   - ソースタイプ選択時に、タイプに応じたフォームフィールドを動的表示
   - 必須項目: ソース名、ソースタイプ、タイプ固有の必須フィールド
   - ステータス選択（デフォルトは有効）

3. **ソース編集**
   - 既存ソースの行の「編集」ボタンでモーダル表示
   - 現在の値をフォームに初期表示
   - タイプに応じたフィールドを表示
   - すべての項目を編集可能

4. **ソース削除**
   - 削除前に確認ダイアログを表示
   - 削除成功時は一覧から即時削除

5. **ソース検索**
   - ソース名、タイプで検索可能
   - リアルタイムフィルタリング

6. **ステータス切り替え**
   - 有効/無効をトグルボタンで切り替え
   - 切り替え時は即時APIに反映

## バリデーション要件
1. **共通項目**
   - ソース名: 必須入力、最大100文字、重複チェック（同一名称は不可）
   - ソースタイプ: 必須選択、選択肢: "youtube", "rss", "arxiv", "other"

2. **YouTube固有項目**
   - チャンネルID: 必須入力、YouTubeチャンネルID形式
   - チャンネルURL: 必須入力、youtube.comドメインを含む
   - フィードURL: オプション、有効なURL形式
   - 登録者数: オプション、数値のみ
   - サムネイルURL: オプション、有効なURL形式

3. **RSS固有項目**
   - サイトURL: 必須入力、有効なURL形式
   - フィードURL: 必須入力、有効なURL形式
   - 言語: オプション、選択肢から選択
   - ファビコンURL: オプション、有効なURL形式

4. **arXiv固有項目**
   - カテゴリ: 必須選択、arXivカテゴリ一覧から選択
   - 検索クエリ: 必須入力

## エラーメッセージ
- 入力検証エラー:
  - 「ソース名を入力してください」
  - 「ソース名は100文字以内で入力してください」
  - 「同じ名前のソースが既に存在します」
  - 「チャンネルIDを入力してください」（YouTube）
  - 「チャンネルURLを入力してください」（YouTube）
  - 「サイトURLを入力してください」（RSS）
  - 「フィードURLを入力してください」（RSS）
  - 「カテゴリを選択してください」（arXiv）
  - 「検索クエリを入力してください」（arXiv）
  - 「有効なURL形式で入力してください」

- 操作エラー:
  - 「ソースの追加に失敗しました」
  - 「ソースの更新に失敗しました」
  - 「ソースの削除に失敗しました」
  - 「ステータスの変更に失敗しました」

## API連携
1. **ソース一覧取得API**
   - エンドポイント: `/api/admin/sources`
   - メソッド: GET
   - クエリパラメータ: `page`, `pageSize`, `search`, `type`, `active`
   - レスポンス: 更新されたAPIレスポンス形式に対応

2. **ソース追加API**
   - エンドポイント: `/api/admin/sources`
   - メソッド: POST
   - リクエストボディ: 更新されたAPIリクエスト形式に対応
   - レスポンス: 作成されたソースオブジェクト

3. **ソース更新API**
   - エンドポイント: `/api/admin/sources/[id]`
   - メソッド: PUT
   - リクエストボディ: 更新するフィールド（タイプ固有情報を含む）
   - レスポンス: 更新されたソースオブジェクト

4. **ソース削除API**
   - エンドポイント: `/api/admin/sources/[id]`
   - メソッド: DELETE
   - レスポンス: 成功時は204 No Content

5. **ステータス変更API**
   - エンドポイント: `/api/admin/sources/[id]`
   - メソッド: PATCH
   - リクエストボディ: `{ "active": true/false }`
   - レスポンス: 更新されたソースオブジェクト

## UI/UX考慮事項
1. **テーブルレイアウト**
   - スクロール可能なテーブル
   - 列幅の自動調整
   - モバイル表示時はカード形式に変更
   - タイプに応じた詳細情報の表示方法を最適化

2. **モーダルフォーム**
   - ソースタイプ選択時に動的にフォームフィールドを変更
   - フォーカス自動設定（開いたら最初の入力欄に）
   - Escキーでモーダルを閉じる
   - 入力中のリアルタイムバリデーション

3. **フィードバック**
   - 操作成功時は通知メッセージを表示
   - 長時間操作時はローディングインジケータを表示

4. **確認ダイアログ**
   - 削除操作時は確認ダイアログを表示
   - 「キャンセル」と「削除」ボタンを明確に区別

5. **アクセシビリティ**
   - キーボード操作のサポート
   - スクリーンリーダー対応
   - 適切なARIA属性の使用

## 実装上の注意事項
1. **データ取得と表示**
   - ページロード時に一覧データを取得
   - ページネーション、検索時は新たにAPIリクエスト
   - データ取得中はスケルトンローダーを表示

2. **フォーム処理**
   - フォーム状態管理にはReact Hook Form等のライブラリ活用
   - ソースタイプに応じたフォームフィールドの動的表示
   - 送信前にクライアント側でバリデーション
   - 送信中はボタンを無効化

3. **エラーハンドリング**
   - API通信エラーの適切な処理
   - ユーザーフレンドリーなエラーメッセージ表示
   - 必要に応じてリトライ機能

4. **最適化**
   - 不要なAPIリクエストの削減
   - メモ化によるレンダリング最適化
   - デバウンス処理（検索入力時など）

5. **セキュリティ**
   - 入力値のサニタイズ
   - CSRF対策
   - 認証・認可の確認

6. **テスト**
   - 各CRUD操作のユニットテスト
   - フォームバリデーションのテスト
   - エラー状態のテスト