echo "ğŸ” ãƒ—ãƒƒã‚·ãƒ¥å‰ã«å‹ãƒã‚§ãƒƒã‚¯ã¨ãƒ†ã‚¹ãƒˆã‚’å®Ÿè¡Œã—ã¦ã„ã¾ã™..."

# ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®ãƒ«ãƒ¼ãƒˆãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã«ç§»å‹•
cd "$(git rev-parse --show-toplevel)"

# digeclipãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã«ç§»å‹•
cd digeclip

# å®Ÿè¡Œé–‹å§‹æ™‚é–“ã‚’è¨˜éŒ²
start_time=$(date +%s)

# å‹ãƒã‚§ãƒƒã‚¯ã®å®Ÿè¡Œ
echo "TypeScriptã®å‹ãƒã‚§ãƒƒã‚¯ã‚’å®Ÿè¡Œä¸­..."
npm run type-check
typecheck_result=$?

# Jestãƒ†ã‚¹ãƒˆã®å®Ÿè¡Œ
echo "Jestãƒ†ã‚¹ãƒˆã‚’å®Ÿè¡Œä¸­..."
npm run test
test_result=$?

# Prettierãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆãƒã‚§ãƒƒã‚¯ã®å®Ÿè¡Œ
echo "Prettierãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆãƒã‚§ãƒƒã‚¯ã‚’å®Ÿè¡Œä¸­..."
npm run format
format_result=$?

# å®Ÿè¡Œçµ‚äº†æ™‚é–“ã‚’è¨˜éŒ²
end_time=$(date +%s)
execution_time=$((end_time - start_time))

# çµæœã®è¡¨ç¤º
echo "============================="
echo "å®Ÿè¡Œçµæœ"

# ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ãŸã‹ã©ã†ã‹ã‚’åˆ¤å®š
if [ $typecheck_result -ne 0 ] || [ $test_result -ne 0 ] || [ $format_result -ne 0 ]; then
  echo "âœ— ä»¥ä¸‹ã®ãƒã‚§ãƒƒã‚¯ãŒå¤±æ•—ã—ã¾ã—ãŸ:"
  [ $typecheck_result -ne 0 ] && echo "  - å‹ãƒã‚§ãƒƒã‚¯"
  [ $test_result -ne 0 ] && echo "  - ãƒ†ã‚¹ãƒˆ"
  [ $format_result -ne 0 ] && echo "  - ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆãƒã‚§ãƒƒã‚¯"
  exit_code=1
else
  echo "âœ“ ã™ã¹ã¦ã®ãƒã‚§ãƒƒã‚¯ãŒæˆåŠŸã—ã¾ã—ãŸ"
  exit_code=0
fi

echo "åˆè¨ˆå®Ÿè¡Œæ™‚é–“: ${execution_time}ç§’"

exit $exit_code