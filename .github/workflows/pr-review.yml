name: PR自動レビュー

on:
  pull_request:
    types: [opened, synchronize]

jobs:
  pr-check:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3

      - name: Node.jsのセットアップ
        uses: actions/setup-node@v3
        with:
          node-version: '20'
          cache: 'npm'
          cache-dependency-path: 'digeclip/package-lock.json'

      - name: 依存関係のインストール
        working-directory: digeclip
        run: npm ci

      - name: ESLintによるリント
        working-directory: digeclip
        run: npm run lint || echo "lintコマンドが失敗しました"

      - name: TypeScriptの型チェック
        working-directory: digeclip
        run: npm run type-check || echo "type-checkコマンドが失敗しました"

      - name: アクセシビリティチェック
        working-directory: digeclip
        run: |
          if grep -q "axe-core" package.json; then
            echo "アクセシビリティテストを実行します"
            npm run test:a11y || echo "アクセシビリティテストをスキップします"
          else
            echo "アクセシビリティテストをスキップします"
          fi

      - name: ビルドサイズチェック
        working-directory: digeclip
        run: echo "ビルドサイズチェックをスキップします"