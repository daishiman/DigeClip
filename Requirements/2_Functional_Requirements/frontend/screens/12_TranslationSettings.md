# 翻訳機能画面仕様書

## 画面概要
コンテンツの要約結果を複数の言語に翻訳するための設定画面です。翻訳対象言語の選択、翻訳品質の設定、翻訳APIの設定などを管理します。多言語対応により、異なる言語を使用するユーザーに対しても要約コンテンツを提供できるようになります。

## 画面レイアウト
```
+----------------------------------------------------------------------+
|  DigeClip > 翻訳設定                                   ユーザー名 ▼ |
+----------------------------------------------------------------------+
|                                                                      |
|  +-------------------------------------------------------------------+
|  | 翻訳機能                                                         |
|  +-------------------------------------------------------------------+
|  | 翻訳機能:                                                        |
|  | (⚪) 有効  (⚫) 無効                                              |
|  |                                                                  |
|  | 翻訳タイミング:                                                  |
|  | (⚪) 要約生成時に自動翻訳                                        |
|  | (⚫) オンデマンド翻訳（表示時に翻訳）                            |
|  +-------------------------------------------------------------------+
|                                                                      |
|  +-------------------------------------------------------------------+
|  | 翻訳対象言語                                                     |
|  +-------------------------------------------------------------------+
|  | 利用可能な言語:                                                  |
|  |                                                                  |
|  | [✓] 英語 (English)       [ ] フランス語 (Français)              |
|  | [✓] 日本語 (日本語)      [ ] ドイツ語 (Deutsch)                 |
|  | [ ] 中国語 (简体中文)    [ ] スペイン語 (Español)               |
|  | [ ] 韓国語 (한국어)      [ ] イタリア語 (Italiano)              |
|  | [ ] ロシア語 (Русский)   [ ] ポルトガル語 (Português)           |
|  |                                                                  |
|  | [すべて選択] [すべて解除]                                        |
|  |                                                                  |
|  | デフォルト言語: [日本語 ▼]                                       |
|  +-------------------------------------------------------------------+
|                                                                      |
|  +-------------------------------------------------------------------+
|  | 翻訳API設定                                                      |
|  +-------------------------------------------------------------------+
|  | 翻訳サービス:                                                    |
|  | [Google Cloud Translation ▼]                                     |
|  |                                                                  |
|  | API Key:                                                         |
|  | [********************************]                                |
|  |                                                                  |
|  | 翻訳品質:                                                        |
|  | [高品質 ▼] (標準/高品質/ドラフト)                                |
|  |                                                                  |
|  | 翻訳モデル:                                                      |
|  | [最新 ▼] (最新/基本/ニューラル)                                  |
|  +-------------------------------------------------------------------+
|                                                                      |
|  +-------------------------------------------------------------------+
|  | テスト翻訳                                                       |
|  +-------------------------------------------------------------------+
|  | テキスト:                                                        |
|  | [これは翻訳のテストです。                                      ] |
|  |                                                                  |
|  | 翻訳先言語: [英語 ▼]                                             |
|  |                                                                  |
|  | [翻訳テスト実行]                                                 |
|  |                                                                  |
|  | 結果:                                                            |
|  | [This is a translation test.]                                    |
|  +-------------------------------------------------------------------+
|                                                                      |
|  [キャンセル]                                          [保存]        |
|                                                                      |
+----------------------------------------------------------------------+
```

## 機能要件
1. **翻訳機能の有効/無効**
   - トグルスイッチで翻訳機能全体の有効/無効を切り替え
   - 無効時は翻訳関連の処理をスキップ

2. **翻訳タイミング設定**
   - 要約生成時に自動翻訳: 要約完了後すぐに翻訳を実行
   - オンデマンド翻訳: ユーザーが表示時に必要に応じて翻訳

3. **翻訳対象言語選択**
   - チェックボックスで複数の言語を選択可能
   - 主要言語（英語、日本語、中国語など）をサポート
   - すべて選択/すべて解除ボタン
   - デフォルト言語の設定（コンテンツ表示時の初期言語）

4. **翻訳API設定**
   - 翻訳サービスの選択（Google Cloud Translation, DeepL, Microsoft Translator など）
   - API Keyの設定
   - 翻訳品質の選択（品質と速度のバランス）
   - 翻訳モデルの選択（サービスによって異なる）

5. **テスト翻訳機能**
   - サンプルテキストの入力
   - 翻訳先言語の選択
   - テスト実行ボタン
   - 翻訳結果の表示

6. **設定の保存/キャンセル**
   - 変更を保存するボタン
   - 変更をキャンセルするボタン

## バリデーション要件
1. **翻訳対象言語**
   - 最低1つの言語を選択必須
   - デフォルト言語は選択された言語の中から選択必須

2. **API設定**
   - 翻訳機能が有効な場合、翻訳サービスの選択は必須
   - 選択したサービスに応じたAPI Keyの形式チェック
   - API Keyは翻訳機能が有効な場合は必須

3. **テスト翻訳**
   - テスト実行時はテキスト入力必須
   - テキストの最大長は1000文字

## エラーメッセージ
- 入力検証エラー:
  - 「翻訳対象言語を最低1つ選択してください」
  - 「デフォルト言語は選択された言語から選んでください」
  - 「翻訳サービスを選択してください」
  - 「API Keyを入力してください」
  - 「有効なAPI Key形式ではありません」
  - 「テストテキストを入力してください」
  - 「テキストは1000文字以内で入力してください」

- 操作エラー:
  - 「設定の保存に失敗しました」
  - 「翻訳テストに失敗しました」
  - 「API Keyの検証に失敗しました」
  - 「選択した翻訳サービスは現在利用できません」

## API連携
1. **翻訳設定取得API**
   - エンドポイント: `/api/translation-settings`
   - メソッド: GET
   - レスポンス:
     ```json
     {
       "enabled": true,
       "translationTiming": "auto",
       "languages": ["en", "ja", "zh-CN"],
       "defaultLanguage": "ja",
       "service": {
         "provider": "google",
         "apiKey": "********",
         "quality": "high",
         "model": "latest"
       },
       "updatedAt": "2023-03-15T09:45:00Z"
     }
     ```

2. **翻訳設定更新API**
   - エンドポイント: `/api/translation-settings`
   - メソッド: PUT
   - リクエストボディ: 更新する設定オブジェクト
   - レスポンス: 更新された設定オブジェクト

3. **API Key検証API**
   - エンドポイント: `/api/translation-settings/verify-key`
   - メソッド: POST
   - リクエストボディ: `{ "provider": "google", "apiKey": "..." }`
   - レスポンス: `{ "valid": true/false, "message": "..." }`

4. **テスト翻訳API**
   - エンドポイント: `/api/translation/test`
   - メソッド: POST
   - リクエストボディ:
     ```json
     {
       "text": "これは翻訳のテストです。",
       "targetLanguage": "en",
       "service": {
         "provider": "google",
         "apiKey": "...",
         "quality": "high",
         "model": "latest"
       }
     }
     ```
   - レスポンス:
     ```json
     {
       "translatedText": "This is a translation test.",
       "sourceLanguage": "ja",
       "targetLanguage": "en",
       "processingTime": 0.5
     }
     ```

5. **サポート言語取得API**
   - エンドポイント: `/api/translation/supported-languages`
   - メソッド: GET
   - クエリパラメータ: `provider`
   - レスポンス:
     ```json
     {
       "languages": [
         { "code": "en", "name": "English", "nativeName": "English" },
         { "code": "ja", "name": "Japanese", "nativeName": "日本語" },
         { "code": "zh-CN", "name": "Chinese (Simplified)", "nativeName": "简体中文" },
         // ...
       ]
     }
     ```

## UI/UX考慮事項
1. **言語選択UI**
   - 言語名は現地語と英語の両方を表示
   - 言語グループ分け（アジア言語、ヨーロッパ言語など）
   - 検索フィルタ（言語数が多い場合）

2. **API設定UI**
   - API Keyはマスク表示（セキュリティ）
   - 表示/非表示切り替えボタン
   - サービスごとの設定項目の動的表示

3. **テスト翻訳UI**
   - 結果表示エリアの適切なサイズ
   - 翻訳中のローディング表示
   - 成功/失敗の視覚的フィードバック

4. **設定変更フィードバック**
   - 変更された設定の視覚的強調
   - 保存前の確認（特に多数の言語を選択した場合）
   - 保存成功/失敗の通知

5. **アクセシビリティ**
   - 多言語対応のラベルとエラーメッセージ
   - キーボード操作のサポート
   - スクリーンリーダー対応

## 実装上の注意事項
1. **翻訳サービス連携**
   - 各翻訳サービスのAPI仕様の違いを吸収する抽象化レイヤー
   - サービス固有のパラメータ対応
   - エラーハンドリングの統一

2. **パフォーマンス考慮**
   - 大量の言語選択時のシステム負荷
   - 翻訳処理のキューイングと非同期処理
   - キャッシュ戦略（同じ内容の重複翻訳を避ける）

3. **セキュリティ対策**
   - API Keyの暗号化保存
   - 権限管理（翻訳設定は管理者のみ変更可能）
   - 外部サービス連携時のセキュリティ考慮

4. **多言語対応**
   - 文字エンコーディングの適切な処理
   - 右から左へ記述する言語（アラビア語、ヘブライ語など）のサポート
   - 言語固有の表示問題への対応

5. **コスト管理**
   - 翻訳APIの使用量モニタリング
   - コスト上限の設定（オプション）
   - 使用状況レポート機能（将来拡張）

6. **テスト**
   - 各翻訳サービスとの連携テスト
   - 多言語文字の正しい表示テスト
   - エラー状態のテスト