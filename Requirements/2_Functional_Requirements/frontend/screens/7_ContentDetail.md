# コンテンツ詳細画面仕様書

## 画面概要
コンテンツを1件ごとに詳細表示する画面です。YouTube動画や論文、ブログ記事などのタイトルやサムネイル、元リンク、さらにAI要約結果をまとめて確認できます。タグの追加・削除や通知履歴の確認も可能です。ユーザーがコンテンツの詳細情報と要約を効率的に閲覧できる中心的な画面となります。

## 画面レイアウト
```
+----------------------------------------------------------------------+
|  DigeClip > コンテンツ一覧 > コンテンツ詳細            ユーザー名 ▼ |
+----------------------------------------------------------------------+
|                                                                      |
|  +-------------------------------------------------------------------+
|  | AI技術の最新動向 2025年版                                        |
|  +-------------------------------------------------------------------+
|                                                                      |
|  +-------------------+  +-------------------------------------------+|
|  |                   |  | 公開日: 2023/03/15                        ||
|  |  [サムネイル画像] |  | ソース: YouTube                           ||
|  |                   |  | チャンネル: テックチャンネル              ||
|  |                   |  | 状態: 要約済み                            ||
|  |                   |  |                                           ||
|  |  [元コンテンツを  |  | タグ: [AI] [テクノロジー] [+ 追加]        ||
|  |   開く]           |  |                                           ||
|  +-------------------+  +-------------------------------------------+|
|                                                                      |
|  要約                                                                |
|  +-------------------------------------------------------------------+
|  | [GPT-4 ▼] [概要 | 詳細]                                          |
|  |                                                                   |
|  | 【概要】                                                          |
|  | この動画は2025年におけるAI業界の主要な発展について解説している。  |
|  | 特に生成AIの進化、自律システムの普及、倫理的枠組みの標準化について|
|  | 重点的に触れている。                                             |
|  |                                                                   |
|  | 【詳細】                                                          |
|  | 1. 生成AIの進化: マルチモーダルモデルが標準となり...             |
|  | 2. 自律システムの普及: 家庭用ロボットの普及率が先進国で20%を突破...|
|  | 3. 倫理的枠組み: ISO/IEC 42001がグローバルスタンダードとして...   |
|  |                                                                   |
|  | [再要約]                                                          |
|  +-------------------------------------------------------------------+
|                                                                      |
|  元テキスト                                                          |
|  +-------------------------------------------------------------------+
|  | 本日は2025年のAI業界の最新動向についてお話しします...             |
|  | (長文テキスト - スクロール可能)                                  |
|  +-------------------------------------------------------------------+
|                                                                      |
|  通知履歴                                                            |
|  +-------------------------------------------------------------------+
|  | 2023/03/15 15:30 - Discordに通知送信                             |
|  | 2023/03/15 15:00 - 要約完了                                      |
|  | 2023/03/15 14:45 - コンテンツ取得                                |
|  +-------------------------------------------------------------------+
|                                                                      |
|  [← 一覧に戻る]                                                      |
|                                                                      |
+----------------------------------------------------------------------+
```

## 機能要件
1. **コンテンツ基本情報表示**
   - タイトル
   - サムネイル画像
   - 公開日
   - ソースタイプ（YouTube/RSS/arXiv等）
   - ソース詳細（チャンネル名等）
   - ステータス（要約済み/処理中/エラー）
   - 元コンテンツへのリンク

2. **タグ管理**
   - 現在のタグ一覧表示
   - タグの追加機能
   - タグの削除機能

3. **要約表示**
   - AIモデル選択（複数モデルで要約している場合）
   - 要約タイプ切り替え（概要/詳細）
   - 要約テキスト表示
   - 再要約ボタン（将来拡張）

4. **元テキスト表示**
   - 元コンテンツから抽出したテキスト
   - 長文の場合はスクロール可能

5. **通知履歴**
   - 時系列での通知・処理履歴
   - 各イベントの日時と内容

6. **ナビゲーション**
   - 一覧画面への戻るリンク
   - パンくずリスト

## バリデーション要件
1. **タグ追加**
   - 最大20文字
   - 重複チェック（同一タグは追加不可）
   - 最大タグ数チェック（例: 1コンテンツあたり10個まで）

2. **再要約リクエスト**
   - 連打防止（クールダウン期間設定）
   - 権限チェック（管理者のみ可能など）

## エラーメッセージ
- タグ操作エラー:
  - 「タグ名が長すぎます。20文字以内で入力してください」
  - 「このタグは既に追加されています」
  - 「タグの最大数（10個）に達しています」
  - 「タグの追加に失敗しました」
  - 「タグの削除に失敗しました」

- コンテンツ取得エラー:
  - 「コンテンツの取得に失敗しました」
  - 「要約データが見つかりません」
  - 「元テキストの取得に失敗しました」

- 再要約エラー:
  - 「再要約リクエストの送信に失敗しました」
  - 「再要約は30分に1回までです。後でお試しください」

## API連携
1. **コンテンツ詳細取得API**
   - エンドポイント: `/api/user/contents/[id]`
   - メソッド: GET
   - レスポンス:
     ```json
     {
       "id": 42,
       "title": "AIの最新動向 2025年版",
       "url": "https://www.youtube.com/watch?v=abc123",
       "raw_text": "本日は2025年のAI業界の最新動向についてお話しします...(省略)...",
       "metadata": {
         "thumbnail": "https://i.ytimg.com/vi/abc123/maxresdefault.jpg",
         "duration": 1234,
         "channelName": "テックチャンネル"
       },
       "tags": ["AI", "テクノロジー"],
       "status": "summarized",
       "summaries": [
         {
           "aiModelId": 1,
           "stage": "overview",
           "summaryText": "この動画は2025年におけるAI業界の主要な発展について解説している。特に生成AIの進化、自律システムの普及、倫理的枠組みの標準化について重点的に触れている。"
         },
         {
           "aiModelId": 1,
           "stage": "detail",
           "summaryText": "1. 生成AIの進化: マルチモーダルモデルが標準となり...(省略)...\n2. 自律システムの普及: 家庭用ロボットの普及率が先進国で20%を突破...(省略)...\n3. 倫理的枠組み: ISO/IEC 42001がグローバルスタンダードとして...(省略)..."
         }
       ],
       "notifiedAt": "2023-03-15T15:30:00Z",
       "published_at": "2023-03-15T14:30:00Z",
       "events": [
         {
           "type": "notification_sent",
           "timestamp": "2023-03-15T15:30:00Z",
           "details": { "platform": "discord" }
         },
         {
           "type": "summary_completed",
           "timestamp": "2023-03-15T15:00:00Z",
           "details": { "aiModelId": 1 }
         },
         {
           "type": "content_fetched",
           "timestamp": "2023-03-15T14:45:00Z",
           "details": { "source": "youtube" }
         }
       ]
     }
     ```

2. **タグ追加API**
   - エンドポイント: `/api/user/contents/[id]/tags`
   - メソッド: POST
   - リクエストボディ: `{ "tag": "新しいタグ" }`
   - レスポンス: 更新されたタグ一覧

3. **タグ削除API**
   - エンドポイント: `/api/user/contents/[id]/tags/[tagName]`
   - メソッド: DELETE
   - レスポンス: 更新されたタグ一覧

4. **再要約リクエストAPI**（将来拡張）
   - エンドポイント: `/api/user/contents/[id]/resummary`
   - メソッド: POST
   - リクエストボディ: `{ "aiModelId": 1 }`
   - レスポンス: ステータス情報

## UI/UX考慮事項
1. **レイアウト**
   - 重要情報を上部に配置
   - 長文コンテンツはスクロール可能な領域に
   - モバイル表示時は縦に並べる

2. **要約表示**
   - 概要と詳細をタブで切り替え
   - 複数AIモデルの場合はドロップダウンで選択
   - 要約テキストは読みやすいフォントとサイズ

3. **タグUI**
   - タグはチップ形式で表示
   - 削除可能なタグには削除アイコン
   - タグ追加はインラインフォームまたはモーダル

4. **メタデータ表示**
   - ソースタイプに応じたアイコン表示
   - 日付は読みやすい形式（相対時間も検討）
   - ステータスは色分けして視覚的に区別

5. **通知履歴**
   - 時系列で上から新しい順に表示
   - イベントタイプに応じたアイコン
   - 詳細情報はホバーまたはクリックで表示

6. **アクセシビリティ**
   - キーボードナビゲーション対応
   - スクリーンリーダー対応
   - 適切なコントラスト比

## 実装上の注意事項
1. **データ取得と表示**
   - ページロード時に詳細データを取得
   - 大きなテキストデータは必要に応じて遅延読み込み
   - 要約テキストの改行やフォーマットを適切に表示

2. **タグ操作**
   - タグ追加・削除は即時APIに反映
   - 操作中はローディング状態を表示
   - 成功/失敗のフィードバックを明確に

3. **元コンテンツリンク**
   - 外部リンクは新しいタブで開く
   - リンク先の安全性に関する注意喚起（必要に応じて）
   - YouTube動画の場合は埋め込みプレーヤーの検討

4. **エラーハンドリング**
   - データ取得失敗時の適切なフォールバックUI
   - 部分的なデータ取得失敗時も、取得できた部分は表示
   - ユーザーフレンドリーなエラーメッセージ

5. **パフォーマンス最適化**
   - 画像の最適化（サイズ、形式）
   - 長文テキストの効率的な表示
   - コンポーネントの遅延読み込み

6. **セキュリティ**
   - XSS対策（特に外部コンテンツの表示時）
   - CSRF対策
   - 認証・認可の確認

7. **テスト**
   - 各データ表示のユニットテスト
   - タグ操作のインテグレーションテスト
   - レスポンシブデザインのテスト