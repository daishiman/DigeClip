# タグ管理画面仕様書

## 画面概要
コンテンツに付与するタグを一元管理するための画面です。タグの一覧表示、新規作成、編集、削除などの基本的なCRUD操作に加え、タグの色設定やグループ化、並べ替えなどの高度な管理機能を提供します。効率的なコンテンツ分類と検索のために、体系的なタグ管理を可能にします。

## 画面レイアウト
```
+----------------------------------------------------------------------+
|  DigeClip > タグ管理                                   ユーザー名 ▼ |
+----------------------------------------------------------------------+
|                                                                      |
|  [+ 新規タグ追加]                検索: [                ]           |
|                                                                      |
|  +-------------------------------------------------------------------+
|  | タグ一覧                                                         |
|  +-------------------------------------------------------------------+
|  | 名前          | 色      | グループ     | 使用数    | 操作        |
|  +---------------+---------+--------------+-----------+-------------+
|  | AI            | #3498db | テクノロジー | 42        | 編集 削除   |
|  | プログラミング | #2ecc71 | テクノロジー | 28        | 編集 削除   |
|  | 量子コンピュータ| #9b59b6 | テクノロジー | 15        | 編集 削除   |
|  | ウェブ開発    | #e74c3c | 開発         | 36        | 編集 削除   |
|  | ...           | ...     | ...          | ...       | ...         |
|  +-------------------------------------------------------------------+
|                                                                      |
|  ドラッグ＆ドロップで並べ替えができます                              |
|                                                                      |
|  ページ: < 1 2 3 ... 5 >                                            |
|                                                                      |
+----------------------------------------------------------------------+

// モーダル: 新規タグ追加/編集
+--------------------------------------+
|  タグ追加/編集                    ✕ |
+--------------------------------------+
|                                      |
|  タグ名*:                            |
|  [                             ]     |
|                                      |
|  色:                                 |
|  [カラーピッカー] #3498db            |
|                                      |
|  グループ:                           |
|  [テクノロジー ▼]                    |
|                                      |
|  説明:                               |
|  [                             ]     |
|  [                             ]     |
|                                      |
|  [キャンセル]        [保存]          |
|                                      |
+--------------------------------------+
```

## 機能要件
1. **タグ一覧表示**
   - テーブル形式で表示
   - カラム: タグ名、色（カラーサンプル表示）、グループ、使用数、操作
   - ページネーション機能
   - 検索フィルタリング

2. **新規タグ追加**
   - 「新規タグ追加」ボタンでモーダル表示
   - 必須項目: タグ名
   - オプション項目: 色、グループ、説明

3. **タグ編集**
   - 既存タグの「編集」ボタンでモーダル表示
   - 現在の値をフォームに初期表示
   - すべての項目を編集可能

4. **タグ削除**
   - 削除前に確認ダイアログを表示
   - 使用中のタグの場合は警告メッセージを表示

5. **タグの並べ替え**
   - ドラッグ＆ドロップによる手動並べ替え
   - 並べ替え結果の保存

6. **タググループ管理**
   - グループの作成・編集・削除
   - タグのグループへの割り当て

7. **色設定**
   - カラーピッカーによる色選択
   - カラーコードの直接入力も可能

## バリデーション要件
1. **タグ名**
   - 必須入力
   - 最大20文字
   - 重複チェック（同一名称は不可）
   - 先頭と末尾の空白は自動削除

2. **色**
   - 有効なカラーコード形式（#RRGGBB）
   - 未指定の場合はデフォルト色を適用

3. **グループ**
   - 最大30文字
   - 未指定の場合は「未分類」グループに自動割り当て

4. **説明**
   - 最大200文字

## エラーメッセージ
- 入力検証エラー:
  - 「タグ名を入力してください」
  - 「タグ名は20文字以内で入力してください」
  - 「同じ名前のタグが既に存在します」
  - 「有効なカラーコード形式で入力してください」
  - 「グループ名は30文字以内で入力してください」
  - 「説明は200文字以内で入力してください」

- 操作エラー:
  - 「タグの追加に失敗しました」
  - 「タグの更新に失敗しました」
  - 「タグの削除に失敗しました」
  - 「このタグは現在使用中です。削除する前に関連コンテンツからタグを外してください」
  - 「タグの並べ替えの保存に失敗しました」

## API連携
1. **タグ一覧取得API**
   - エンドポイント: `/api/tags`
   - メソッド: GET
   - クエリパラメータ: `page`, `pageSize`, `search`, `group`
   - レスポンス:
     ```json
     {
       "data": [
         {
           "id": 1,
           "name": "AI",
           "color": "#3498db",
           "group": "テクノロジー",
           "description": "人工知能関連のコンテンツ",
           "usageCount": 42,
           "order": 1
         },
         // ...
       ],
       "pagination": {
         "page": 1,
         "pageSize": 10,
         "total": 42
       }
     }
     ```

2. **タグ追加API**
   - エンドポイント: `/api/tags`
   - メソッド: POST
   - リクエストボディ:
     ```json
     {
       "name": "新しいタグ",
       "color": "#3498db",
       "group": "テクノロジー",
       "description": "説明文"
     }
     ```
   - レスポンス: 作成されたタグオブジェクト

3. **タグ更新API**
   - エンドポイント: `/api/tags/[id]`
   - メソッド: PUT
   - リクエストボディ: 更新するフィールド
   - レスポンス: 更新されたタグオブジェクト

4. **タグ削除API**
   - エンドポイント: `/api/tags/[id]`
   - メソッド: DELETE
   - レスポンス: 成功時は204 No Content

5. **タグ並べ替えAPI**
   - エンドポイント: `/api/tags/reorder`
   - メソッド: POST
   - リクエストボディ: `{ "orders": [{"id": 1, "order": 3}, {"id": 2, "order": 1}, ...] }`
   - レスポンス: 成功時は200 OK

6. **タググループ一覧API**
   - エンドポイント: `/api/tag-groups`
   - メソッド: GET
   - レスポンス:
     ```json
     {
       "data": [
         { "id": 1, "name": "テクノロジー" },
         { "id": 2, "name": "開発" },
         // ...
       ]
     }
     ```

## UI/UX考慮事項
1. **カラー表示**
   - タグの色はテーブル内で視覚的に表示（カラーサンプル）
   - カラーピッカーは使いやすいUIで、色相環と明度/彩度選択を提供

2. **ドラッグ＆ドロップ**
   - 直感的な並べ替えUI
   - ドラッグ中は視覚的フィードバック
   - 並べ替え完了時は自動保存または保存ボタン表示

3. **グループ管理**
   - グループの階層表示（オプション）
   - グループごとの折りたたみ/展開機能

4. **使用数表示**
   - タグが使用されているコンテンツ数を表示
   - クリックで関連コンテンツ一覧へ遷移

5. **検索機能**
   - タグ名、グループによるフィルタリング
   - リアルタイム検索結果表示

6. **アクセシビリティ**
   - キーボード操作のサポート
   - スクリーンリーダー対応
   - 色選択時の色名表示（アクセシビリティ向上）

## 実装上の注意事項
1. **パフォーマンス**
   - タグ数が多い場合の表示最適化
   - 並べ替え操作の効率的な実装

2. **データ管理**
   - タグ削除時の関連データ処理（使用中のタグは削除制限または警告）
   - グループ削除時の所属タグの処理（未分類へ移動など）

3. **UI実装**
   - ドラッグ＆ドロップには react-beautiful-dnd などのライブラリ活用
   - カラーピッカーには react-color などのライブラリ活用

4. **エラーハンドリング**
   - API通信エラーの適切な処理
   - 並べ替え操作中の競合解決

5. **拡張性**
   - 将来的なタグ機能拡張（階層化、関連タグ、自動タグ付けなど）を考慮した設計

6. **テスト**
   - 各CRUD操作のユニットテスト
   - ドラッグ＆ドロップ機能のテスト
   - カラーピッカーのテスト