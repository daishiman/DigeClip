```markdown
# 保守運用要件 (最新版)

> **方針**
> - **経験の浅いエンジニア**が中心となっても **低コスト**で保守できる体制
> - **Vercel + Supabase 無料枠** を前提にしつつ、**将来的な拡張**も考慮
> - **運用体制やドキュメント整備**を最小限の手間で整え、段階的に強化

---

## 1. 運用体制

1. **オンコール対応**
   - 無料規模の運用を想定しているため、専任オンコールは設置しない
   - 軽度障害は、運用担当が Slack/Discord 等の通知を確認し、業務時間内に対応
   - 重大障害（致命的ダウンなど）のみ、チーム内で **24時間内** 対応を目指す

2. **運用担当者数**
   - 最小構成として**1名〜2名**が管理者 (admin ロール) として兼務
   - 担当者が複数名いる場合は、月単位でローテーション
   - リソース状況に応じて必要なら追加

3. **運用スケジュール**
   - 定期モニタリング：週1回(ダッシュボード確認)
   - バックアップ作業：DBダンプ等を週1回手動取得
   - 機能追加/アップデート：月1〜2回程度

---

## 2. 監視ツール

1. **利用ツール**
   - **Vercel Dashboard**: デプロイ状況、Serverless Functions のエラー確認
   - **Supabase Dashboard**: DBリソース(CPU/メモリ/ストレージ)の監視、ログ閲覧
   - **Discord / Slack**: 障害通知チャネルとして利用（Webhook連携）

2. **収集指標**
   - **Serverless関数のエラーレート** (Vercel)
   - **DB使用量** (Supabase 無料枠上限)
   - **Cron実行結果** (成功/失敗ログ)
   - **AI API呼び出し回数** (OpenAIなど)  → コスト管理

3. **分析方法**
   - 週次で主要メトリクス (APIエラー回数, Cron失敗回数 等) を簡単にレビュー
   - 問題や傾向があればスプレッドシート等で管理し、対策を検討

---

## 3. 障害対応フロー

1. **インシデント管理**
   - 問題発生時にDiscordやSlackでアラート受領 → 運用担当が内容確認
   - 事象を「軽度・中度・重大」に分類し、優先度を決定

2. **エスカレーション手順**
   - **軽度 (例: 一部機能が停止/遅延)**: 担当者が業務時間内に修正対応
   - **中度 (例: DB容量上限近い、Cron実行失敗が続く)**: 担当者が即日対応 or 有料プラン検討
   - **重大 (例: 全面ダウン、データ消失リスク)**: 24時間以内に緊急対応、チーム全員へ連絡

3. **復旧プロセス**
   - 原因調査 (Vercel/Supabase Dashboard, ログ解析)
   - 暫定対策 (再デプロイ, DB拡張, リトライ)
   - 必要に応じてバックアップからの復旧 or 有料プランへのアップグレード
   - 復旧後、問題原因をドキュメント化して再発防止策を検討

---

## 4. ドキュメント管理

1. **保管場所**
   - GitHubリポジトリの `/docs` フォルダ or Notion/Confluence 等で管理
   - バックアップ/リストア手順、認証設定、Cron設定、運用チェックリストなどをまとめる

2. **バージョン管理ルール**
   - ドキュメント変更は**Pull Request**ベースでレビュー
   - バージョンタグ or リリースノートを運用し、更新内容を履歴化

3. **更新フロー**
   - 機能追加/設定変更のたびに**対応手順を更新**
   - 運用担当が週1回確認し、最新状況を反映

---

## 5. 定期メンテナンス

1. **パッチ適用頻度**
   - **Node.js/Next.js/Tailwind** などは minor アップデートがある程度安定してから月1回程度更新
   - **Supabase** は自動更新（プラットフォーム側）かつ有償プランほどの大規模パッチは不要

2. **メンテナンス告知方法**
   - Discord のシステム通知チャンネル or Slack
   - 「メンテ時間 (30分程度)」「影響範囲」を事前案内

3. **Downtime想定**
   - 無料プランで**0ダウンタイム**難 → メンテナンス時に短時間の停止を許容
   - 事前に「メンテナンスページ」表示 or Discordでアナウンス

---

### まとめ

- **運用体制**は最小限（1〜2名の管理者が週次確認）で開始 → 障害対応はDiscord通知
- **監視ツール**はVercel/Supabaseダッシュボード、Discord/Slackでのアラート
- **障害対応フロー**は3段階(軽度・中度・重大)、24h以内の復旧が目標
- **ドキュメント管理**はGitHubリポジトリ or Notionで随時更新
- **定期メンテナンス**は月1回程度、影響範囲をDiscordで告知し、ダウンタイムを最小化
- 予算と規模が拡大した場合は有料プランや外部監視ツール導入等を検討する
```