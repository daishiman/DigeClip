```markdown
# 可用性・信頼性要件 (最新版)

> **方針**
> - **最小コスト**での運用を重視（Vercel無料プラン＋Supabase無料枠）
> - **経験の浅いエンジニア**でも簡単に冗長化やバックアップを設定できるようにする
> - 将来的に**大規模スケール**やディザスタリカバリを行いやすい拡張性を確保

---

## 1. SLA (サービス稼働率目標)

1. **稼働率目標**
   - 現段階では **99.0%** を目標 (約月に 7時間ダウンまで許容)
   - Vercel Hobbyプランの稼働率は保証されていないが、実測では高い可用性を期待
   - Supabase無料枠も大規模障害が少なく、同程度の可用性を想定
2. **許容ダウンタイム**
   - **メンテナンスウィンドウ**: 毎月1回(数十分程度)
   - 予期せぬ障害発生時の**復旧目標**: 1〜2時間以内

---

## 2. 冗長化

1. **Vercel**
   - 無料プランでも**CDNエッジ**にホストされ、ビルド後コンテンツは自動的に冗長化
   - サーバレス関数はマルチリージョンではなく、指定リージョン単位（Hobbyプランでは基本US1など）
2. **Supabase**
   - 無料枠では**シングルAZ** (単一リージョン) のみ
   - 将来必要になれば**有料プラン**でMulti-AZや**レプリケーション**を検討
3. **ロードバランサ / オートスケール**
   - Vercelサーバレスの特性上、**リクエストごとに自動スケール**
   - ロードバランサはVercelの内部で抽象化されており、ユーザーが設定不要

---

## 3. バックアップ / リストア

1. **バックアップ取得頻度**
   - **Supabase**:
     - 無料プランでは**自動バックアップは無し** → 週1回程度の**手動Dump**を推奨
     - (有料プランで自動スナップショット対応)
   - **Vercel**:
     - ソースコードはGitHubで管理し、バージョン管理でバックアップ不要
     - サーバレス関数の状態はステートレス
2. **保存先**
   - SupabaseのDBダンプを**ローカル or Cloud Storage (例: Google Drive)** へ暗号化して保存
   - Dumpファイルを**最低3世代**保持
3. **復旧手順**
   - DB障害時:
     1. 最新のダンプファイルをダウンロード
     2. Supabaseの管理画面 or psqlでリストア
     3. アプリを再デプロイ or 再起動
   - VercelのGitHub連携を使用しており、ソースコードのロールバックは**Gitリポジトリ**のバージョンを戻すだけ

---

## 4. DR(ディザスタリカバリ)計画

1. **RTO (目標復旧時間) / RPO (目標復旧時点)**
   - **RTO**: 24時間以内 (無料プランでの手動復旧を想定)
   - **RPO**: 最後に取得したDump以降のデータは失われる可能性 → 数日〜1週間相当
2. **別リージョンへのレプリケーション**
   - 無料枠では不可 → 将来、有料プランで別リージョンへの**自動レプリケーション**を検討
   - 予算があればAWS/Azureへのバックアップ転送も検討
3. **手順概要**
   - **リージョン障害時**: Supabaseの有料プランに切り替え→別リージョンにDBを復元
   - **Vercel**: Hobbyプランにリージョン指定オプションあり(一部対応) → 必要ならProプランで複数リージョンデプロイを考慮

---

## 5. 監視とアラート

1. **監視項目**
   - Vercelの**デプロイ状況**、**関数エラー** (5xx)
   - Supabaseの**DBヘルス** (CPU/メモリ/ストレージ使用量)
   - 定期実行(Cron)の**成功/失敗**ログ
2. **通知方法**
   - Vercel → GitHub連携 or Slack/Discord連携でデプロイ成功/失敗アラート
   - Supabase → メールやWebhookでDB残容量アラート
   - Cron失敗 → Discord or Slackで通知
3. **障害時の対応フロー**
   1. 監視アラート受信 → 管理者が**ダッシュボード**確認
   2. エラーログやSupabaseコンソールのヘルス状況チェック
   3. 短時間で復旧しない場合 → 手動でデプロイ再試行 or DB復旧
   4. 場合によりユーザーに**アナウンス** (Discordチャンネルなど)

---

### まとめ

- **可用性**は無料プラン運用で**99%**程度を想定
- **冗長化**はVercelのサーバレス特性である程度カバー、DBは有料プランでMulti-AZに対応可能
- **バックアップ**はSupabase無料枠では手動Dump必須 → 週1回程度
- **DR計画**は最低限のDump復旧で **RTO=24時間, RPO=~1週間** まで
- **監視**はVercelとSupabaseのダッシュボード＋アラート連携、障害時は手動復旧を基本とし、将来の拡張も可能
```